@use "~/styles/system/media";

// adapted from TailwindCSS typography plugin
// MIT License, Copyright (c) Tailwind Labs, Inc.

$not: "[class~='not-prose'] *";

.prose {
	font-size: 1rem;
	line-height: 1.825;

	max-width: none;

	:where([class~="lead"]):not(:where(#{$not})) {
		font-size: 1.25em;
		line-height: 1.6;
		margin-bottom: 1.2em;
		margin-top: 1.2em;
	}

	:where(a):not(:where(#{$not})) {
		border-bottom: 0;
		color: var(--cs-color-text-link);
		text-decoration: underline;
		text-decoration-color: var(--cs-color-text-link-underline);
		text-decoration-thickness: 1px;
	}

	:where(strong):not(:where(#{$not})) {
		font-weight: var(--cs-font-weight-text-bold);
	}

	:where(ol):not(:where(#{$not})) {
		list-style-type: decimal;
		padding-left: 1.625em;
	}

	:where(ol[type="A"]):not(:where(#{$not})) {
		list-style-type: upper-alpha;
	}

	:where(ol[type="a"]):not(:where(#{$not})) {
		list-style-type: lower-alpha;
	}

	:where(ol[type="A s"]):not(:where(#{$not})) {
		list-style-type: upper-alpha;
	}

	:where(ol[type="a s"]):not(:where(#{$not})) {
		list-style-type: lower-alpha;
	}

	:where(ol[type="I"]):not(:where(#{$not})) {
		list-style-type: upper-roman;
	}

	:where(ol[type="i"]):not(:where(#{$not})) {
		list-style-type: lower-roman;
	}

	:where(ol[type="I s"]):not(:where(#{$not})) {
		list-style-type: upper-roman;
	}

	:where(ol[type="i s"]):not(:where(#{$not})) {
		list-style-type: lower-roman;
	}

	:where(ol[type="1"]):not(:where(#{$not})) {
		list-style-type: decimal;
	}

	:where(ul):not(:where(#{$not})) {
		list-style-type: disc;
		padding-left: 1.625em;
	}

	:where(ol > li):not(:where(#{$not}))::marker {
		// color: ???
		font-weight: var(--cs-font-weight-list-marker);
	}

	:where(ul > li):not(:where(#{$not}))::marker {
		// color: ???
		font-weight: var(--cs-font-weight-list-marker);
	}

	:where(hr):not(:where(#{$not})) {
		border-color: var(--cs-color-border);
		border-top-width: 1px;
		margin-bottom: 3em;
		margin-top: 3em;
	}

	:where(blockquote):not(:where(#{$not})) {
		border-left-color: var(--cs-color-border);
		border-left-width: 0.25rem;
		color: var(--cs-color-text-weaker);
		font-style: inherit;
		font-weight: var(--cs-font-weight-blockquote);
		margin-bottom: 1.6em;
		margin-top: 1.6em;
		padding-left: 1em;
		quotes: "\201C""\201D""\2018""\2019";
	}

	:where(blockquote p:first-of-type):not(:where([class~="not-prose"]
				*))::before {
		content: open-quote;
	}

	:where(blockquote p:last-of-type):not(:where(#{$not})):after {
		content: close-quote;
	}

	:where(h1, h2, h3, h4):not(:where(#{$not})) {
		font-weight: var(--cs-font-weight-heading);
	}
	:where(h5, h6):not(:where(#{$not})) {
		font-weight: var(--cs-font-weight-heading-sm);
	}

	:where(h1 strong, h2 strong, h3 strong, h4 strong):not(:where(#{$not})) {
		font-weight: var(--cs-font-weight-heading-bold);
	}
	:where(h5 strong, h6 strong):not(:where(#{$not})) {
		font-weight: var(--cs-font-weight-heading-sm-bold);
	}

	:where(h1):not(:where(#{$not})) {
		font-size: 2.25em;
		line-height: 1.25;
		margin-bottom: 0.8888889em;
		margin-top: 0;
	}

	:where(h2):not(:where(#{$not})) {
		font-size: 1.5em;
		line-height: 1.3333333;
		margin-bottom: 1em;
		margin-top: 2em;
	}

	:where(h3):not(:where(#{$not})) {
		font-size: 1.25em;
		line-height: 1.6;
		margin-bottom: 0.6em;
		margin-top: 1.6em;
		position: relative;
		scroll-margin-top: var(--scroll-mt);
	}

	:where(h4):not(:where(#{$not})) {
		line-height: 1.5;
		margin-bottom: 0.5em;
		margin-top: 1.5em;
	}

	:where(figure > *):not(:where(#{$not})) {
		margin-bottom: 0;
		margin-top: 0;
	}

	:where(figcaption):not(:where(#{$not})) {
		color: var(--cs-color-text-weakest);
		font-size: 0.875em;
		line-height: 1.4285714;
		margin-top: 0.8571429em;
	}

	:where(code):not(:where(#{$not})) {
		display: inline-block;
		font-size: inherit;
		font-variant-ligatures: none;
		font-weight: var(--cs-font-weight-code);
		position: relative;
	}

	:where(code):not(:where(#{$not}))::before {
		content: "`";
	}

	:where(code):not(:where(#{$not})):after {
		content: "`";
	}

	:where(a code):not(:where(#{$not})) {
		color: inherit;
	}

	:where(pre):not(:where(#{$not})) {
		background-color: var(--code-background);
		border: 1px solid var(--cs-color-border);
		border-radius: 0.75rem;
		box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
			0 2px 4px -2px rgba(0, 0, 0, 0.1);
		color: var(--cs-color-text-code-block);
		display: flex;
		font-size: 0.875em;
		font-weight: var(--cs-font-weight-code-block);
		line-height: 1.7142857;
		margin-bottom: 2em;
		margin-top: 2em;
		overflow-x: auto;
		padding: 1.25rem;
	}

	:where(pre code):not(:where(#{$not})) {
		background-color: transparent;
		border-radius: 0;
		border-width: 0;
		color: inherit;
		flex: none;
		font-family: inherit;
		font-size: inherit;
		font-weight: inherit;
		line-height: inherit;
		min-width: 100%;
		padding: 0;
	}

	:where(pre code):not(:where(#{$not}))::before {
		content: none;
	}

	:where(pre code):not(:where(#{$not})):after {
		content: none;
	}

	:where(table):not(:where(#{$not})) {
		font-size: 0.875rem;
		line-height: 1.42;
		margin-bottom: 2em;
		margin-top: 2em;
		table-layout: auto;
		text-align: left;
		width: 100%;
	}

	:where(thead):not(:where(#{$not})) {
		border-bottom-color: var(--cs-color-border);
		border-bottom-width: 1px;
		color: inherit;
	}

	:where(thead th):not(:where(#{$not})) {
		color: inherit;
		font-weight: var(--cs-font-weight-table-heading);
		padding: 0 0.5714286em 0.5714286em;
		vertical-align: bottom;
	}

	:where(tbody tr):not(:where(#{$not})) {
		border-bottom-color: #f2f5f8;
		border-bottom-width: 1px;
	}

	:where(tbody tr:last-child):not(:where(#{$not})) {
		border-bottom-width: 1px;
	}

	:where(tbody td):not(:where(#{$not})) {
		padding: 0.5714286em;
		vertical-align: baseline;
	}

	:where(p):not(:where(#{$not})) {
		margin-bottom: 1.25em;
		margin-top: 1.25em;
	}

	:where(img):not(:where(#{$not})) {
		margin-bottom: 2em;
		margin-top: 2em;
	}

	:where(video):not(:where(#{$not})) {
		margin-bottom: 2em;
		margin-top: 2em;
	}

	:where(figure):not(:where(#{$not})) {
		margin-bottom: 2em;
		margin-top: 2em;
	}

	:where(h2 code):not(:where(#{$not})) {
		font-size: 0.875em;
	}

	:where(h3 code):not(:where(#{$not})) {
		font-size: 0.9em;
	}

	:where(li):not(:where(#{$not})) {
		margin-bottom: 0.5em;
		margin-top: 0.5em;
	}

	:where(ol > li):not(:where(#{$not})) {
		padding-left: 0.375em;
	}

	:where(ul > li):not(:where(#{$not})) {
		padding-left: 0.375em;
	}

	> :where(ul > li p):not(:where(#{$not})) {
		margin-bottom: 0.75em;
		margin-top: 0.75em;
	}

	> :where(ul > li > :first-child):not(:where(#{$not})) {
		margin-top: 1.25em;
	}

	> :where(ul > li > :last-child):not(:where(#{$not})) {
		margin-bottom: 1.25em;
	}

	> :where(ol > li > :first-child):not(:where(#{$not})) {
		margin-top: 1.25em;
	}

	> :where(ol > li > :last-child):not(:where(#{$not})) {
		margin-bottom: 1.25em;
	}

	:where(ul ul, ul ol, ol ul, ol ol):not(:where(#{$not})) {
		margin-bottom: 0.75em;
		margin-top: 0.75em;
	}

	:where(hr + *):not(:where(#{$not})) {
		margin-top: 0;
	}

	:where(h2 + *):not(:where(#{$not})) {
		margin-top: 0;
	}

	:where(h3 + *):not(:where(#{$not})) {
		margin-top: 0;
	}

	:where(h4 + *):not(:where(#{$not})) {
		margin-top: 0;
	}

	:where(thead th:first-child):not(:where(#{$not})) {
		padding-left: 0;
	}

	:where(thead th:last-child):not(:where(#{$not})) {
		padding-right: 0;
	}

	:where(tbody td:first-child):not(:where(#{$not})) {
		padding-left: 0;
	}

	:where(tbody td:last-child):not(:where(#{$not})) {
		padding-right: 0;
	}

	> :where(:first-child):not(:where(#{$not})) {
		margin-top: 0;
	}

	> :where(:last-child):not(:where(#{$not})) {
		margin-bottom: 0;
	}

	:where(a:visited):not(:where(#{$not})) {
		color: var(--cs-color-text-link-visited);
	}

	:where(a:hover):not(:where(#{$not})) {
		color: var(--cs-color-text-link-hover);
		text-decoration-color: var(--cs-color-text-link-underline-hover);
		text-decoration-thickness: 2px;
	}

	:where(a strong):not(:where(#{$not})) {
		color: inherit;
	}

	:where(p):not(:where(#{$not})) {
		font-weight: var(--cs-font-weight-text);
	}

	:where(li, dd):not(:where(#{$not})) {
		font-weight: var(--cs-font-weight-list-item);
	}

	:where(dd):not(:where(#{$not})) {
		margin-bottom: 0.5em;
	}

	:where(dt):not(:where(#{$not})) {
		font-weight: var(--cs-font-weight-list-item-heading);
		margin-top: 0.5em;
	}

	:where(h1, h2):not(:where(#{$not})) {
		position: relative;
		scroll-margin-top: var(--scroll-mt);
	}

	:where(h4, h5, h6):not(:where(#{$not})) {
		position: relative;
		scroll-margin-top: var(--scroll-mt);
	}

	:where(tbody code):not(:where(#{$not})) {
		font-size: 0.75rem;
	}

	:where(figure figcaption):not(:where(#{$not})) {
		font-style: italic;
	}

	:where(figure > figcaption):not(:where(#{$not})) {
		margin-top: 1.25em;
	}

	:where(figure > img):not(:where(#{$not})) {
		margin-bottom: 0;
	}

	:where(pre[data-line-numbers="true"]):not(:where(#{$not})) {
		padding-left: 3.5rem;
		position: relative;
	}

	:where(.codeblock-line):not(:where(#{$not})) {
		display: block;
		width: 100%;
	}

	:where(.codeblock-line[data-line-number]):not(:where([class~="not-prose"]
				*)) {
		position: relative;

		&::before {
			content: attr(data-line-number);
			position: absolute;
			font: inherit;
			line-height: inherit;
			display: block;
			right: calc(100% + 1rem);
			opacity: 0.325;
			text-align: right;
		}
	}

	:where(pre[data-lang]):not(:where(#{$not})) {
		position: relative;

		&::before {
			content: attr(data-lang);
			position: absolute;
			right: 1.325rem;
			top: 1.125rem;
			font-size: 0.8em;
			font-weight: var(--cs-font-weight-code-bold);
			text-transform: uppercase;
			letter-spacing: 2px;
			opacity: 0.325;
		}

		@media (media.get(sm-down)) {
			&::before {
				display: none;
			}
		}
	}

	:where(.footnote-ref, .footnote-back):not(:where(#{$not})) {
		display: inline-block;
		text-decoration: none;
		margin-left: 0.25em;
	}

	:where(.footnotes):not(:where(#{$not})) {
		color: var(--cs-color-text-weaker);

		ol {
			counter-reset: footnotes;
		}

		& li {
			list-style: none;
			position: relative;
		}

		& li::before {
			counter-increment: footnotes;
			content: counter(footnotes);
			position: absolute;
			top: 0;
			left: -1.5rem;
			font-weight: var(--cs-font-weight-list-marker);
			color: var(--cs-color-text-weakest);
			opacity: 0.8;
		}
	}

	:where(.data-footnote-backref):not(:where(#{$not})) {
		font-size: 80%;
		font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont,
			"Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
	}

	:where(aside):not(:where(#{$not})) {
		font-weight: inherit;
		font-style: inherit;
		margin-top: 1.6em;
		margin-bottom: 1.6em;
		padding: 1em;
		background-color: hsl(150 60% 57% / 0.1);
		border: 1px solid hsl(150 60% 57% / 0.5);
		border-radius: 0.75rem;

		> :where(:first-child) {
			margin-top: 0;
		}

		> :where(:last-child) {
			margin-bottom: 0;
		}
	}

	> :where(:first-child):not(:where(#{$not})) {
		margin-top: 0;
	}

	> :where(:last-child):not(:where(#{$not})) {
		margin-bottom: 0;
	}

	@media (media.get(dark)) {
		:where(pre):not(:where(#{$not})) {
			box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
				0 2px 4px -2px rgba(0, 0, 0, 0.1);
		}
	}
}

.prose-markdown {
	@media (media.get(lg)) {
		:where(h1, h2, h3, h4, h5, h6):not(:where(#{$not})) {
			position: relative;
		}

		:where(h1, h2, h3, h4, h5, h6):not(:where(#{$not}))::before {
			content: "#";
			position: absolute;
			right: calc(100% + 1rem);
			text-align: right;
			top: 0;
			opacity: 0.325;
		}

		:where(h2):not(:where(#{$not}))::before {
			content: "##";
		}

		:where(h3):not(:where(#{$not}))::before {
			content: "###";
		}

		:where(h4):not(:where(#{$not}))::before {
			content: "####";
		}

		:where(h5):not(:where(#{$not}))::before {
			content: "#####";
		}

		:where(h6):not(:where(#{$not}))::before {
			content: "######";
		}
	}
}
